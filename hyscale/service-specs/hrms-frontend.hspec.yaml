name: hrms-frontend
depends: 
      - hrdatabase
image:
   buildSpec:
     stackImage: tomcat-image:8.5.15 #specify the stackImage and StackImage version taken from platform in image:version format
     update: 1   #specify update version of stack-image
     artifacts: 
         - name: HRScaffold_war
           source:
              store: JFrog  # artifact store name from the platform
              repository: "HRScaffold"
              path: "${BUILD_NUM}/HRScaffold.war"
           destination: usr/local/content/tomcat/current/webapps/hrms.war
replicas: 1 
memory: 2048
ports:
     - port: 8080
       healthCheck:
         httpPath: /hrms
       external: true
       lbMappings:
         tls: false
         contextPaths:
         - path: /hrms
volumes:
  - name: tomcat-logs
    path: /usr/local/tomcat/logs
    size: 1 
    readOnly: false
    storageClass: "{{ hfs_STORAGE_CLASS | default ('gp2') }}" # storage class name from the cluster to use for pvc procurement
props:
    - key: JAVA_HOME
      value: "{{ hfs_JAVA_HOME | default ('/usr/local/java') }}"
    - key: TOMCAT_HOME
      value: "{{ hfs_JAVA_HOME | default ('/usr/local/content/tomcat') }}"
    - key: COUNTRY
      value: "{{ hfs_COUNTRY | default ('INDIA') }}"
    - key: REGION
      value: "{{ hfs_COUNTRY | default ('HYS') }}"
    - key: MAX_NO_OF_THREADS
      value: "{{ hfs_MAX_NO_OF_THREADS | default ('20') }}"
    - key: MAX_NO_OF_CONNECTIONS
      value: "{{ hfs_MAX_NO_OF_CONNECTIONS | default ('10') }}"
    - key: MYSQL_HOST
      value: hrdatabase
      type: ENDPOINT
    - key: MYSQL_ROOT_PASSWORD
      value: cHJhbWF0aQ==
      type: PASSWORD
agents:
    - name: fluentd
      image: fluentd:4.3 # side car image and version in the image:version format from the platform
      props:
      - key: FLUENTD_ARGS
        value: "--no-supervisor -vv"
      - key: "system.input.conf"
        type: FILE
        value: "/var/lib/jenkins/workspace/HRMS-APP-CD-CI/hyscale/service-specs/config/system.input.conf"  # add the full path to this file
      - key: "output.conf"
        type: FILE
        value: "/var/lib/jenkins/workspace/HRMS-APP-CD-CI/hyscale/service-specs/config/output.conf"    # add the full path to this file
      volumes:
      - path: "/mnt/log"
        name: "tomcat-logs" # should be same as the volume name of frontend container

